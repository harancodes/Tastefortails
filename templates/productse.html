
{% extends 'base.html' %}  

{% load static %}

{% block content %}

<div class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <!-- Page Title with subtle animation -->
        <div class="text-center mb-10" data-aos="fade-down">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">doof doog</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">Discover our handpicked selection of exceptional timepieces</p>
        </div>

        <!-- Search & Filter Container -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-10 transition-all duration-300 hover:shadow-xl">
            <!-- Search Bar -->
            <form method="GET" action="{% url 'product' %}" class="relative mb-8">
                <div class="flex items-center overflow-hidden rounded-lg border-2 border-gray-200 focus-within:border-blue-500 transition-all duration-300 hover:border-blue-300">
                    <input 
                        type="text" 
                        name="search" 
                        placeholder="Find your perfect timepiece..." 
                        value="{% if search_query %}{{ search_query }}{% else %}{% endif %}" 
                        class="w-full px-6 py-4 text-gray-700 focus:outline-none"
                    >
                    <button 
                        type="submit" 
                        class="px-6 py-4 bg-blue-600 text-white hover:bg-blue-700 transition-all duration-300 flex items-center gap-2"
                    >
                        <i class="fas fa-search"></i>
                        <span class="hidden sm:inline">Search</span>
                    </button>
                </div>
            </form>

            <!-- Filters and Sorting Section -->
            <div>
                <div class="flex items-center justify-between mb-5">
                    <h2 class="text-xl font-semibold text-gray-800">Refine Results</h2>
                    <button id="toggleFilters" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center gap-1">
                        <i class="fas fa-sliders-h"></i> <span>Filters</span>
                    </button>
                </div>
                
                <div id="filterSection" class="grid grid-cols-1 lg:grid-cols-4 gap-5">
                    <!-- Brand Filter -->
                    <div class="filter-group">
                        <label for="brand" class="block text-sm font-medium text-gray-700 mb-2">Brand</label>
                        <div class="relative">
                            <select id="brand" name="brand" class="block w-full pl-4 pr-10 py-3 text-base border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none transition-all duration-300 hover:border-blue-300">
                                <option value="">All Brands</option>
                                {% for brand in brands %}
                                    <option value="{{ brand.id }}" {% if brand_filter == brand.id|stringformat:"s" %}selected{% endif %}>{{ brand.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Category Filter -->
                    <div class="filter-group">
                        <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                        <div class="relative">
                            <select id="category" name="category" class="block w-full pl-4 pr-10 py-3 text-base border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none transition-all duration-300 hover:border-blue-300">
                                <option value="">All Categories</option>
                                {% for category in categories %}
                                    <option value="{{ category.id }}" {% if category_filter == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
                                {% endfor %}
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="filter-group">
                        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
                        <div class="relative">
                            <select id="price" name="price" class="block w-full pl-4 pr-10 py-3 text-base border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none transition-all duration-300 hover:border-blue-300">
                                <option value="">All Prices</option>
                                <option value="0-100" {% if price_filter == "0-100" %}selected{% endif %}>Under $100</option>
                                <option value="100-500" {% if price_filter == "100-500" %}selected{% endif %}>$100 - $500</option>
                                <option value="500-1000" {% if price_filter == "500-1000" %}selected{% endif %}>$500 - $1000</option>
                                <option value="1000-" {% if price_filter == "1000-" %}selected{% endif %}>Over $1000</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Sorting -->
                    <div class="filter-group">
                        <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                        <div class="relative">
                            <select id="sort" name="sort" class="block w-full pl-4 pr-10 py-3 text-base border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none transition-all duration-300 hover:border-blue-300">
                                <option value="">Popular</option>
                                <option value="price_asc" {% if sort_by == "price_asc" %}selected{% endif %}>Price: Low to High</option>
                                <option value="price_desc" {% if sort_by == "price_desc" %}selected{% endif %}>Price: High to Low</option>
                                <option value="name_asc" {% if sort_by == "name_asc" %}selected{% endif %}>Name: A to Z</option>
                                <option value="name_desc" {% if sort_by == "name_desc" %}selected{% endif %}>Name: Z to A</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Featured Timepieces</h2>
                <div class="flex items-center gap-2 text-sm text-gray-500">
                    <span>Showing <span class="font-semibold">{{ products|length }}</span> products</span>
                </div>
            </div>
            
            <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                {% for product in products %}
                <a href="#" class="group">
                    <div class="product-card bg-white rounded-xl overflow-hidden shadow-lg transition-all duration-500 hover:shadow-2xl transform hover:-translate-y-2 hover:scale-[1.02]">
                        <div class="relative overflow-hidden">
                            <img 
                                src="{{ product.image.url }}" 
                                alt="{{ product.name }}" 
                                class="w-full h-72 object-cover transition-all duration-700 group-hover:scale-110"
                            >
                            
                            <!-- Discount Badge -->
                            {% if product.offer_percentage > 0 %}
                            <div class="absolute top-3 left-3 transform -rotate-3 transition-transform duration-300 group-hover:rotate-0">
                                <span class="bg-gradient-to-r from-blue-600 to-blue-800 text-white text-sm font-bold px-4 py-1.5 rounded-lg shadow-lg flex items-center gap-1">
                                    <i class="fas fa-bolt text-yellow-300"></i>
                                    {{ product.offer_percentage }}% OFF
                                </span>
                            </div>
                            {% endif %}
                            
                            <!-- Hover Overlay -->
                            <div class="absolute inset-0 bg-black bg-opacity-20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                <div class="p-2 bg-white bg-opacity-90 rounded-lg transform translate-y-4 group-hover:translate-y-0 transition-all duration-300">
                                    <span class="text-sm font-medium text-gray-800">View Details</span>
                                </div>
                            </div>
                            
                            <!-- Wishlist Button -->
                            <div class="absolute top-3 right-3 transform scale-90 opacity-80 group-hover:scale-100 group-hover:opacity-100 transition-all duration-300">
                                <button 
                                    class="wishlist-btn bg-white p-3 rounded-full shadow-md hover:bg-gray-100 hover:shadow-lg transition-all duration-300"
                                    onclick="event.stopPropagation(); event.preventDefault(); toggleWishlist({{ product.variants.first.id }})"
                                    data-variant-id="{{ product.variants.first.id }}"
                                    data-in-wishlist="false"
                                >
                                    <i class="far fa-heart text-red-500 text-lg"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-5">
                            <!-- Product Brand & Name -->
                            <div class="mb-3">
                                {% if product.brand %}
                                <p class="text-blue-600 text-xs font-semibold tracking-wider uppercase mb-1">{{ product.brand.name }}</p>
                                {% endif %}
                                <h3 class="font-medium text-gray-800 text-lg line-clamp-1 group-hover:text-blue-600 transition-colors duration-300">{{ product.name }}</h3>
                            </div>
                            
                            <!-- Rating -->
                            <div class="flex text-sm text-yellow-400 mb-3">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span class="text-gray-500 ml-1">(24)</span>
                            </div>
                            
                            <!-- Price and Cart Button -->
                            <div class="flex justify-between items-center">
                                <div class="price-container">
                                    {% if product.sales_price < product.regular_price %}
                                        <span class="text-gray-400 line-through text-sm">₹{{ product.regular_price }}</span>
                                        <span class="text-xl font-bold text-gray-800 ml-2">₹{{ product.sales_price }}</span>
                                    {% else %}
                                        <span class="text-xl font-bold text-gray-800">₹{{ product.sales_price }}</span>
                                    {% endif %}
                                </div>
                                
                                {% if product.variants.all %}
                                <button 
                                    id="addToCartBtn_{{ product.id }}"
                                    onclick="event.stopPropagation(); event.preventDefault(); addCartItem({{ product.variants.first.id }})"
                                    data-stock="{{ product.variants.first.stock }}"
                                    class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-full hover:from-blue-700 hover:to-blue-800 transform hover:scale-105 transition-all duration-300 flex items-center gap-2 shadow-md"
                                >
                                    <i class="fas fa-shopping-cart text-lg"></i>
                                    <span class="text-sm font-medium">Add</span>
                                </button>
                                {% else %}
                                    <span class="bg-gray-200 text-gray-800 px-3 py-1.5 rounded-full text-xs font-medium">Out of Stock</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Filters, Sorting, and Product Shuffling -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Filter toggle functionality
        const toggleFilters = document.getElementById('toggleFilters');
        const filterSection = document.getElementById('filterSection');
        
        toggleFilters.addEventListener('click', function() {
            filterSection.classList.toggle('hidden');
            const iconElement = toggleFilters.querySelector('i');
            if (filterSection.classList.contains('hidden')) {
                iconElement.classList.remove('fa-sliders-h');
                iconElement.classList.add('fa-filter');
                toggleFilters.querySelector('span').textContent = 'Show Filters';
            } else {
                iconElement.classList.remove('fa-filter');
                iconElement.classList.add('fa-sliders-h');
                toggleFilters.querySelector('span').textContent = 'Hide Filters';
            }
        });

        // Filter and sorting functionality
        const brandFilter = document.getElementById('brand');
        const categoryFilter = document.getElementById('category');
        const priceFilter = document.getElementById('price');
        const sortFilter = document.getElementById('sort');

        function applyFilters() {
            const brand = brandFilter.value;
            const category = categoryFilter.value;
            const price = priceFilter.value;
            const sort = sortFilter.value;

            // Redirect or fetch filtered products
            window.location.href = `?brand=${brand}&category=${category}&price=${price}&sort=${sort}`;
        }

        brandFilter.addEventListener('change', applyFilters);
        categoryFilter.addEventListener('change', applyFilters);
        priceFilter.addEventListener('change', applyFilters);
        sortFilter.addEventListener('change', applyFilters);

        // Shuffle products on page load
        function shuffleProducts() {
            const productsGrid = document.getElementById('productsGrid');
            const productCards = Array.from(productsGrid.children);
            
            // Shuffle array
            for (let i = productCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [productCards[i], productCards[j]] = [productCards[j], productCards[i]];
            }
            
            // Append shuffled products
            productCards.forEach(card => {
                productsGrid.appendChild(card);
            });
        }
        
        // Call the shuffle function on page load
        shuffleProducts();
        
        // Add animation effects to products on scroll
        function animateProductsOnScroll() {
            const productCards = document.querySelectorAll('.product-card');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-fadeIn');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            productCards.forEach(card => {
                observer.observe(card);
            });
        }
        
        // Add this if you want animation on scroll
        if ('IntersectionObserver' in window) {
            animateProductsOnScroll();
        }
    });
</script>



<style>
    /* Additional custom animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fadeIn {
        animation: fadeIn 0.5s ease-out forwards;
    }
    
    /* Add line-clamp utility if not available in your Tailwind version */
    .line-clamp-1 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
    }
</style>

{% endblock %}
